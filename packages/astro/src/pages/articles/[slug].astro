---
import BlocksRenderer from "../../components/blocks-renderer"
import Comments from "../../components/comments.astro"
import Seo from "../../components/Seo.astro"
import { getArticle } from "../../data/get-article"
import { getArticleList, StrapiArticleListItem } from "../../data/get-article-list"
import { getGlobal } from "../../data/get-global"
import Layout from "../../layouts/Layout.astro"

export async function getStaticPaths() {
  const articles = await getArticleList()

  return articles.data.map(article => ({
    params: { slug: article.attributes.slug },
    props: { article },
  }))
}

export type Props = {
  article: StrapiArticleListItem
}

const {
  article: { id },
} = Astro.props as Props
const global = await getGlobal()
const article = await getArticle(id)
---

<Layout>
  <Seo type="article" global={global.data} seo={article.data.attributes.seo} slot="seo" />
  <div class="sm:gap-responsive flex h-full flex-col gap-6">
    <div class="mb-responsive flex-1">
      <BlocksRenderer blocks={article.data.attributes.blocks} />
    </div>
    <Comments
      url={new URL(`/articles/${article.data.attributes.slug}`, global.data.attributes.siteURL).toString()}
      identifier={`treten-reisen.article.${article.data.id}`}
      title={article.data.attributes.seo.metaTitle}
    />
  </div>
</Layout>
