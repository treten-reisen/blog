---
import BlocksRenderer from "../components/BlocksRenderer.astro"
import Hero from "../components/Hero.astro"
import HeroMapOverlay from "../components/HeroMapOverlay.astro"
import LatestArticle from "../components/LatestArticle.astro"
import LostItems from "../components/LostItems.astro"
import Map from "../components/map/map"
import Seo from "../components/Seo.astro"
import { getGlobal } from "../data/get-global"
import { getHome } from "../data/get-home"
import { getLiveLocation } from "../data/get-live-location"
import { getPage } from "../data/get-page"
import Layout from "../layouts/Layout.astro"

import "./index.css"

const global = await getGlobal()
const home = await getHome()
const page = await getPage("index")

const avatarUrl = global.data.attributes.avatar.htmlImage.src
if (!avatarUrl) {
  throw new Error("No avatar found")
}
const center = await getLiveLocation()
---

<Layout>
  <Fragment slot="head">
    <Seo type="website" global={global.data} seo={page.attributes.seo} />
  </Fragment>

  <Fragment slot="header">
    <Hero image={home.data.attributes.heroimage} logo={global.data.attributes.logo.data} />
    <section class="relative z-10 h-20 w-full md:container md:mx-auto md:-mb-10 md:-translate-y-1/2 md:px-responsive">
      <div class="h-full w-full overflow-hidden border-gray-700 border-opacity-20 shadow-md md:rounded-lg md:border">
        <Map avatarUrl={avatarUrl} center={center} hideControls client:only="react" />
        <a class="absolute left-0 top-0 h-full w-full md:px-responsive" href="/live-standort"><HeroMapOverlay /></a>
      </div>
    </section>
  </Fragment>

  <div class="flex flex-col-reverse gap-8 md:flex-row md:gap-responsive">
    <div class="mt-8 max-w-prose font-serif">
      <BlocksRenderer blocks={home.data.attributes.blocks} />
    </div>
    <aside
      class="flex shrink-0 flex-grow basis-80 flex-col gap-8 md:gap-responsive-1/2 md:bg-gray-200 md:p-responsive-1/2"
    >
      <LatestArticle />
      <LostItems />
    </aside>
  </div>
</Layout>
