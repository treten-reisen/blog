---
import BlocksRenderer from "../components/BlocksRenderer.astro"
import Hero from "../components/Hero.astro"
import HeroMapOverlay from "../components/HeroMapOverlay.astro"
import LatestArticle from "../components/LatestArticle.astro"
import LostItems from "../components/LostItems.astro"
import Map from "../components/map/map"
import Seo from "../components/Seo.astro"
import { getGlobal } from "../data/get-global"
import { getHome } from "../data/get-home"
import { getLiveLocation } from "../data/get-live-location"
import { getPage } from "../data/get-page"
import Layout from "../layouts/Layout.astro"

import "./index.css"

const global = await getGlobal()
const home = await getHome()
const page = await getPage("index")

const avatarUrl = global.data.attributes.avatar.htmlImage.src
if (!avatarUrl) {
  throw new Error("No avatar found")
}
const center = await getLiveLocation()
---

<Layout>
  <Fragment slot="head">
    <Seo type="website" global={global.data} seo={page.attributes.seo} />
  </Fragment>

  <Fragment slot="header">
    <Hero image={home.data.attributes.heroimage} logo={global.data.attributes.logo.data} />
    <section class="relative h-20 w-full bg-gray-200 shadow">
      <Map avatarUrl={avatarUrl} center={center} hideControls client:only="react" />
      <HeroMapOverlay />
    </section>
  </Fragment>

  <div class="flex flex-col-reverse gap-4 md:flex-row md:gap-responsive">
    <div class="mt-4 max-w-prose font-serif">
      <BlocksRenderer blocks={home.data.attributes.blocks} />
    </div>
    <aside
      class="flex shrink-0 flex-grow basis-80 flex-col gap-4 bg-gray-200 p-4 md:gap-responsive-1/2 md:p-responsive-1/2"
    >
      <LatestArticle />
      <LostItems />
    </aside>
  </div>
</Layout>
