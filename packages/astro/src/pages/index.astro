---
import ArticleList from "../components/article-list"
import Hero from "../components/hero"
import HeroMapOverlay from "../components/hero-map-overlay"
import Map from "../components/map/map"
import Seo from "../components/Seo.astro"
import { getArticleList } from "../data/get-article-list"
import { getGlobal } from "../data/get-global"
import { getHero } from "../data/get-hero"
import Layout from "../layouts/Layout.astro"

const list = await getArticleList()
const hero = await getHero()
const global = await getGlobal()

const strapiUrl = import.meta.env.STRAPI_API_URL
const apiKey = import.meta.env.MAPTILER_API_KEY
const avatarUrl = global.data.attributes.avatar.src
if (!avatarUrl) {
  throw new Error("No avatar found")
}
---

<Layout>
  <Seo type="website" global={global.data} slot="seo" />
  <div class="w-full" slot="header">
    <Hero hero={hero.data} />
    <div class="w-full h-20 relative shadow bg-gray-200">
      <Map backendUrl={strapiUrl} apiKey={apiKey} avatarUrl={avatarUrl} controls={[]} client:only="react" />
      <HeroMapOverlay />
    </div>
  </div>
  <ArticleList articles={list.data} />
</Layout>
